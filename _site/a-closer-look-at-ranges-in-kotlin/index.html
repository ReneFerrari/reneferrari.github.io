<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>[WIP] A closer look at ranges in Kotlin &#8211; Rene Ferrari</title> <meta name="description" content="Why to use them, why they are efficent, how they are implemented."> <meta name="keywords" content=""> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="avatar.jpg"> <meta name="twitter:title" content="[WIP] A closer look at ranges in Kotlin"> <meta name="twitter:description" content="Why to use them, why they are efficent, how they are implemented."> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="[WIP] A closer look at ranges in Kotlin"> <meta property="og:description" content="Why to use them, why they are efficent, how they are implemented."> <meta property="og:url" content="http://localhost:4000/a-closer-look-at-ranges-in-kotlin/"> <meta property="og:site_name" content="Rene Ferrari"> <meta property="og:image" content="http://localhost:4000/images/avatar.jpg"> <link rel="canonical" href="http://localhost:4000/a-closer-look-at-ranges-in-kotlin/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Rene Ferrari" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/unsplash-gallery-image-3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(28, 28, 28, 0.75), rgba(48, 48, 48, 0.75)), url(http://localhost:4000/images/home.jpg) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page" style="background: #ececec52;"> <div style="overflow-y:auto; height: 100%;"> <a href="http://localhost:4000"> <h3 style="margin-left: 56px;">Home</h3> </a> <div class="inner-post content-post" style="padding-top: 0px;"> <h1 style="text-align: center;">[WIP] A closer look at ranges in Kotlin </h1> <div class="date-highlight">15 Jun 2016</div> <h2 id="basics">Basics</h2> <p>In simple terms, a range consists of all the numbers which exist in a certain ordered closed interval (inclusively defined by a lower and an upper bound value). They are a very nice feature of the language and efficent in its use. If you are unfamiliar with ranges but already have a foundational knowledge of Kotlin you may have already encountered them:</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">..</span><span class="m">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure> <p>Behind <code class="highlighter-rouge">1..10</code> lies an <code class="highlighter-rouge">IntRange</code> which is created from the invocation of <code class="highlighter-rouge">rangeTo()</code> (you can check this by going to the definition of the dots between 1 and 10). As I have mentioned previously ranges are inclusive therefore the for loop is equivalent to: <code class="highlighter-rouge">i &gt;= 1 &amp;&amp; i &lt;= 10</code>.</p> <p>If you need to iterate reversed (greater lower bound than upper bound) you can’t use the <code class="highlighter-rouge">..</code> but instead have to rely on <code class="highlighter-rouge">downTo</code>:</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">10</span> <span class="n">downTo</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure> <p>This for loop is equivalent to <code class="highlighter-rouge">i &lt;= 10 &amp;&amp; i &gt;= 1</code>.</p> <p>Another feature of ranges is defining a custom <code class="highlighter-rouge">step</code> (it is 1 by default).</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">2</span><span class="o">..</span><span class="m">10</span> <span class="n">step</span> <span class="m">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure> <p>Now this will only print equal numbers from 2 to 10 inclusively.</p> <p>Sometimes you may need to exclude the upper bound of the range when it is defined by the size of a list. Instead of writing <code class="highlighter-rouge">0..(list.size - 1)</code> you can write <code class="highlighter-rouge">0 until list.size</code> which looks way cleaner. Lastly, if you want to check if a certain value is inside a range you can do that with the <code class="highlighter-rouge">in</code> operator like <code class="highlighter-rouge">5 in 1..10</code>.</p> <h2 id="digging-deeper">Digging deeper</h2> <p>In the previous chapter I have already covered some functionality of ranges but not all of it. When taking a look at the <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.ranges/index.html">content of kotlin.ranges</a> you can see it also contains the following functions (not mentioned yet):</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="kd">val</span> <span class="py">someNumber</span> <span class="p">=</span> <span class="m">67</span>
<span class="kd">val</span> <span class="py">foo</span> <span class="p">=</span> <span class="m">50</span>

<span class="n">println</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">coerceAtLeast</span><span class="p">(</span><span class="n">someNumber</span><span class="p">))</span>
<span class="n">println</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">coerceAtMost</span><span class="p">(</span><span class="n">someNumber</span><span class="p">))</span>
<span class="n">println</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">coerceIn</span><span class="p">(</span><span class="m">0</span><span class="o">..</span><span class="n">someNumber</span><span class="p">))</span></code></pre></figure> <p>This will print <code class="highlighter-rouge">67 50 50</code>. Explanation:</p> <ul> <li><code class="highlighter-rouge">coerceAtLeast</code> will return at least the value of the passed argument. Since 67 is greater than 50 67 is returned</li> <li><code class="highlighter-rouge">coerceAtMost</code> will return at most the value of the passed argument. In our case 67 is less than 50 so 50 is returned</li> <li><code class="highlighter-rouge">coerceIn</code> will return a value inside the range passed as argument of the function. In our case the foo is inside the range so the value of foo (50) is returned. If foo was -1, 0 (the lower bound of the range) would be returned - similarily if foo was 68, 67 (the upper bound) would be returned.</li> </ul> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="n">print</span><span class="p">((</span><span class="m">0</span><span class="o">..</span><span class="m">100</span><span class="p">).</span><span class="n">random</span><span class="p">())</span></code></pre></figure> <p>Random - you guessed it - simply creates a random value from a given range.</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="p">(</span><span class="m">1</span><span class="o">..</span><span class="m">10</span><span class="p">).</span><span class="n">reversed</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure> <p>Basically the same as <code class="highlighter-rouge">10 downTo 1</code> (using <code class="highlighter-rouge">downTo</code> is preferred).</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="n">println</span><span class="p">((</span><span class="m">0</span><span class="o">..</span><span class="m">10</span><span class="p">).</span><span class="n">contains</span><span class="p">(</span><span class="m">5</span><span class="p">))</span></code></pre></figure> <p>Same as <code class="highlighter-rouge">5 in 0..10</code> (using <code class="highlighter-rouge">in</code> is preferred).</p> <h2 id="implementation">Implementation</h2> <h3 id="integer-types">Integer Types</h3> <p>You probably wonder how all of this works. You may believe that a list holding all the values is generated upon initializing a range. Luckily that’s not the case - this would eat up memory needlessly.</p> <p>Now let’s take a look at the implementation (stripped down -&gt; I removed hashCode, toString and equals so only important functions show):</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">public</span> <span class="kd">class</span> <span class="nc">IntRange</span><span class="p">(</span><span class="nv">start</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="nv">endInclusive</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">:</span> <span class="nc">IntProgression</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">endInclusive</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="n">ClosedRange</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">val</span> <span class="py">start</span><span class="p">:</span> <span class="n">Int</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">first</span>
    <span class="k">override</span> <span class="kd">val</span> <span class="py">endInclusive</span><span class="p">:</span> <span class="n">Int</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">last</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">contains</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">first</span> <span class="p">&lt;=</span> <span class="n">value</span> <span class="p">&amp;&amp;</span> <span class="n">value</span> <span class="p">&lt;=</span> <span class="n">last</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">isEmpty</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">first</span> <span class="p">&gt;</span> <span class="n">last</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">public</span> <span class="kd">val</span> <span class="py">EMPTY</span><span class="p">:</span> <span class="n">IntRange</span> <span class="p">=</span> <span class="n">IntRange</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>The function <code class="highlighter-rouge">isEmpty</code> may sound a bit confusing at first but think about it for a moment. A range always has a start and an end as explained earlier. So at some point a range can’t emit new items. This is the case when its start value is larger than its end value - cannot emit anymore items -&gt; empty.</p> <p>As you can clearly see <code class="highlighter-rouge">IntRange</code> extends <code class="highlighter-rouge">IntProgression</code> (<code class="highlighter-rouge">IntRange</code> is just a wrapper class around it) and implements <code class="highlighter-rouge">ClosedRange</code>. ClosedRange is relatively simple and I don’t think it requires much of an explanation:</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">public</span> <span class="kd">interface</span> <span class="nc">ClosedRange</span><span class="p">&lt;</span><span class="nv">T</span><span class="p">:</span> <span class="nc">Comparable</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kd">val</span> <span class="py">start</span><span class="p">:</span> <span class="n">T</span>
    <span class="k">public</span> <span class="kd">val</span> <span class="py">endInclusive</span><span class="p">:</span> <span class="n">T</span>

    <span class="k">public</span> <span class="k">operator</span> <span class="k">fun</span> <span class="nf">contains</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="nc">T</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">value</span> <span class="p">&gt;=</span> <span class="n">start</span> <span class="p">&amp;&amp;</span> <span class="n">value</span> <span class="p">&lt;=</span> <span class="n">endInclusive</span>

    <span class="k">public</span> <span class="k">fun</span> <span class="nf">isEmpty</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">start</span> <span class="p">&gt;</span> <span class="n">endInclusive</span>
<span class="p">}</span></code></pre></figure> <p>Now let’s look at <code class="highlighter-rouge">IntProgression</code></p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">public</span> <span class="k">open</span> <span class="kd">class</span> <span class="nc">IntProgression</span>
    <span class="k">internal</span> <span class="k">constructor</span>
    <span class="p">(</span>
            <span class="nv">start</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
            <span class="nv">endInclusive</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
            <span class="nv">step</span><span class="p">:</span> <span class="nc">Int</span>
    <span class="p">)</span> <span class="p">:</span> <span class="nc">Iterable</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="n">init</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">throw</span> <span class="n">kotlin</span><span class="p">.</span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">"Step must be non-zero."</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="p">==</span> <span class="n">Int</span><span class="p">.</span><span class="n">MIN_VALUE</span><span class="p">)</span> <span class="k">throw</span> <span class="n">kotlin</span><span class="p">.</span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">"Step must be greater than Int.MIN_VALUE to avoid overflow on negation."</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kd">val</span> <span class="py">first</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="n">start</span>

    <span class="k">public</span> <span class="kd">val</span> <span class="py">last</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="n">getProgressionLastElement</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">toInt</span><span class="p">(),</span> <span class="n">endInclusive</span><span class="p">.</span><span class="n">toInt</span><span class="p">(),</span> <span class="n">step</span><span class="p">).</span><span class="n">toInt</span><span class="p">()</span>

    <span class="k">public</span> <span class="kd">val</span> <span class="py">step</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="n">step</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">iterator</span><span class="p">():</span> <span class="nc">IntIterator</span> <span class="p">=</span> <span class="n">IntProgressionIterator</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="k">public</span> <span class="k">open</span> <span class="k">fun</span> <span class="nf">isEmpty</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="n">first</span> <span class="p">&gt;</span> <span class="n">last</span> <span class="k">else</span> <span class="n">first</span> <span class="p">&lt;</span> <span class="n">last</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="cm">/**</span><span class="err">
</span><span class="cm">         * Creates IntProgression within the specified bounds of a closed range.</span><span class="err">

</span><span class="cm">         * The progression starts with the [rangeStart] value and goes toward the [rangeEnd] value not excluding it, with the specified [step].</span><span class="err">
</span><span class="cm">         * In order to go backwards the [step] must be negative.</span><span class="err">
</span><span class="cm">         *</span><span class="err">
</span><span class="cm">         * [step] must be greater than `Int.MIN_VALUE` and not equal to zero.</span><span class="err">
</span><span class="cm">         */</span>
        <span class="k">public</span> <span class="k">fun</span> <span class="nf">fromClosedRange</span><span class="p">(</span><span class="nv">rangeStart</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="nv">rangeEnd</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="nv">step</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">IntProgression</span> <span class="p">=</span> <span class="n">IntProgression</span><span class="p">(</span><span class="n">rangeStart</span><span class="p">,</span> <span class="n">rangeEnd</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>The <code class="highlighter-rouge">iterator()</code> function returns an <code class="highlighter-rouge">IntProgressionIterator</code> instance, so let’s check that class out as well</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">internal</span> <span class="kd">class</span> <span class="nc">IntProgressionIterator</span><span class="p">(</span><span class="nv">first</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="nv">last</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">step</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">:</span> <span class="nc">IntIterator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">finalElement</span> <span class="p">=</span> <span class="n">last</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">hasNext</span><span class="p">:</span> <span class="n">Boolean</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="n">first</span> <span class="p">&lt;=</span> <span class="n">last</span> <span class="k">else</span> <span class="n">first</span> <span class="p">&gt;=</span> <span class="n">last</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">next</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">hasNext</span><span class="p">)</span> <span class="n">first</span> <span class="k">else</span> <span class="n">finalElement</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hasNext</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">hasNext</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">nextInt</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">value</span> <span class="p">=</span> <span class="n">next</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="p">==</span> <span class="n">finalElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">hasNext</span><span class="p">)</span> <span class="k">throw</span> <span class="n">kotlin</span><span class="p">.</span><span class="n">NoSuchElementException</span><span class="p">()</span>
            <span class="n">hasNext</span> <span class="p">=</span> <span class="k">false</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">next</span> <span class="p">+=</span> <span class="n">step</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p><code class="highlighter-rouge">IntProgressionIterator</code> extends from <code class="highlighter-rouge">IntIterator</code> which is just a wrapper class around <code class="highlighter-rouge">Iterator</code> (<code class="highlighter-rouge">next()</code> will invoke <code class="highlighter-rouge">nextInt()</code>). Finally we can see the logic and it is very concise and as you can see <code class="highlighter-rouge">hasNext</code> offers support for negative steps. Inside the <code class="highlighter-rouge">nextInt()</code> function a <code class="highlighter-rouge">NoSuchElementException</code> if there is no next element which you can test very easily</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="kd">val</span> <span class="py">range</span> <span class="p">=</span> <span class="m">0</span><span class="o">..</span><span class="m">10</span>
<span class="kd">val</span> <span class="py">iterator</span> <span class="p">=</span> <span class="n">range</span><span class="p">.</span><span class="n">iterator</span><span class="p">()</span>
<span class="n">iterator</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">print</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
<span class="n">iterator</span><span class="p">.</span><span class="n">nextInt</span><span class="p">()</span> <span class="c1">//will raise the error</span></code></pre></figure> <p>Keep in mind that you must keep a reference on the iterator, because everytime you call <code class="highlighter-rouge">range.iterator()</code> a new <code class="highlighter-rouge">IntProgressionIterator</code> will be created. Otherwise the <code class="highlighter-rouge">nextInt()</code> will initially return the startValue since <code class="highlighter-rouge">next</code> is initialized with <code class="highlighter-rouge">first</code> (or the last element - <code class="highlighter-rouge">if (hasNext) first else finalElement</code>). Then it will return the <code class="highlighter-rouge">value + step</code> and repeat it untill the <code class="highlighter-rouge">finalElement</code> was returned. Once the last element was returned <code class="highlighter-rouge">hasNext</code> will be set to false.</p> <p>In a nutshell int based ranges (int, long, char) don’t hold all values in memory but rather calculate the next value during access. Furthermore a range class is just a wrapper around a progression class.</p> <h3 id="float-types">Float Types</h3> <p>Float types are a different thing. If you want to create a range of double or float using <code class="highlighter-rouge">DoubleRange</code> or <code class="highlighter-rouge">FloatRange</code> you will realize this does not exist. Not even the progression classes. If you instantiate it using the <code class="highlighter-rouge">..</code> operator (<code class="highlighter-rouge">0.5..0.8</code>) you will see that this works. Internally this invokes <code class="highlighter-rouge">rangeTo</code>:</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">public</span> <span class="k">operator</span> <span class="k">fun</span> <span class="nc">Double</span><span class="p">.</span><span class="nf">rangeTo</span><span class="p">(</span><span class="nv">that</span><span class="p">:</span> <span class="nc">Double</span><span class="p">):</span> <span class="nc">ClosedFloatingPointRange</span><span class="p">&lt;</span><span class="nc">Double</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">ClosedDoubleRange</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">that</span><span class="p">)</span></code></pre></figure> <p>This returns a <code class="highlighter-rouge">ClosedFLoatingPointRange&lt;Double&gt;</code>. Previously we have already seen the <code class="highlighter-rouge">ClosedRange&lt;T&gt;</code> class so what’s the difference?</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="nd">@SinceKotlin</span><span class="p">(</span><span class="s">"1.1"</span><span class="p">)</span>
<span class="k">public</span> <span class="kd">interface</span> <span class="nc">ClosedFloatingPointRange</span><span class="p">&lt;</span><span class="n">T</span> <span class="p">:</span> <span class="n">Comparable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;&gt;</span> <span class="p">:</span> <span class="n">ClosedRange</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">contains</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="nc">T</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">lessThanOrEquals</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">lessThanOrEquals</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">endInclusive</span><span class="p">)</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">isEmpty</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="p">!</span><span class="n">lessThanOrEquals</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">endInclusive</span><span class="p">)</span>

    <span class="cm">/**</span><span class="err">
</span><span class="cm">     * Compares two values of range domain type and returns true if first is less than or equal to second.</span><span class="err">
</span><span class="cm">     */</span>
    <span class="k">fun</span> <span class="nf">lessThanOrEquals</span><span class="p">(</span><span class="nv">a</span><span class="p">:</span> <span class="nc">T</span><span class="p">,</span> <span class="nv">b</span><span class="p">:</span> <span class="nc">T</span><span class="p">):</span> <span class="nc">Boolean</span>
<span class="p">}</span></code></pre></figure> <p>Basically <code class="highlighter-rouge">ClosedFloatingPointRange</code> just differs in the implementation of <code class="highlighter-rouge">contains()</code>. The comment above the class explains why:</p> <blockquote> <p>This interface is implemented by floating point ranges returned by [Float.rangeTo] and [Double.rangeTo] operators to achieve IEEE-754 comparison order instead of total order of floating point numbers.</p> </blockquote> <p>To understand this we need some basic background knowledge: Kotlin tries to follow the IEEE-754 standard (for floating point numbers) when the operands are statically typed. However if this is not the case (generics), the IEEE-754 standard is not followed correctly (<a href="https://kotlinlang.org/docs/reference/basic-types.html#floating-point-numbers-comparison">more info</a>).</p> <p>For our case this means that IEEE-754 is not followed exactly in the generic <code class="highlighter-rouge">ClosedFloatingPointRange</code> <code class="highlighter-rouge">contains()</code> function. But float and double do have their own private class which redefines <code class="highlighter-rouge">contains</code> so it complies with the standard.</p> <figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">private</span> <span class="kd">class</span> <span class="nc">ClosedDoubleRange</span><span class="p">(</span>
    <span class="nv">start</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="nv">endInclusive</span><span class="p">:</span> <span class="nc">Double</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ClosedFloatingPointRange</span><span class="p">&lt;</span><span class="nc">Double</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">_start</span> <span class="p">=</span> <span class="n">start</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">_endInclusive</span> <span class="p">=</span> <span class="n">endInclusive</span>
    <span class="k">override</span> <span class="kd">val</span> <span class="py">start</span><span class="p">:</span> <span class="n">Double</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">_start</span>
    <span class="k">override</span> <span class="kd">val</span> <span class="py">endInclusive</span><span class="p">:</span> <span class="n">Double</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">_endInclusive</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">lessThanOrEquals</span><span class="p">(</span><span class="nv">a</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="nv">b</span><span class="p">:</span> <span class="nc">Double</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">a</span> <span class="p">&lt;=</span> <span class="n">b</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">contains</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="nc">Double</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">value</span> <span class="p">&gt;=</span> <span class="n">_start</span> <span class="p">&amp;&amp;</span> <span class="n">value</span> <span class="p">&lt;=</span> <span class="n">_endInclusive</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">isEmpty</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="p">!(</span><span class="n">_start</span> <span class="p">&lt;=</span> <span class="n">_endInclusive</span><span class="p">)</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">equals</span><span class="p">(</span><span class="nv">other</span><span class="p">:</span> <span class="nc">Any</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">other</span> <span class="k">is</span> <span class="n">ClosedDoubleRange</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">isEmpty</span><span class="p">()</span> <span class="p">&amp;&amp;</span> <span class="n">other</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">()</span> <span class="p">||</span>
                <span class="n">_start</span> <span class="p">==</span> <span class="n">other</span><span class="p">.</span><span class="n">_start</span> <span class="p">&amp;&amp;</span> <span class="n">_endInclusive</span> <span class="p">==</span> <span class="n">other</span><span class="p">.</span><span class="n">_endInclusive</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hashCode</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="n">isEmpty</span><span class="p">())</span> <span class="p">-</span><span class="m">1</span> <span class="k">else</span> <span class="m">31</span> <span class="p">*</span> <span class="n">_start</span><span class="p">.</span><span class="n">hashCode</span><span class="p">()</span> <span class="p">+</span> <span class="n">_endInclusive</span><span class="p">.</span><span class="n">hashCode</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="s">"$_start..$_endInclusive"</span>
<span class="p">}</span></code></pre></figure> <p>This implementation applies to the concept of <a href="https://en.wikipedia.org/wiki/Total_order">total order</a>.</p> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> </div> </body> </html>
